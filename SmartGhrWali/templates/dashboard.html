{% extends "layout.html" %}

{% block title %}
Smart Ghr Wali
{% endblock %}

{% block content %}
<link rel="stylesheet" href="/static/css/dashboard.css">
<link rel="stylesheet" href="/static/css/homepage.css">
<!-- <h1 class="text-center mt-4">Welcome to Smart Ghr Wali</h1> -->

<div class="card  p-3 bg-body roundedp-5 m-3 ">
 <h4 class="mb-4 fw-bold">Inventory</h4>
 <div class="row g-3">
      <!-- Total items Card -->
      <div class="col-md-3">
        <div class="card text-bg-info mb-3 p-1 shadow text-center">
            <div class="d-flex align-items-center justify-content-center ">
                <div class=" me-2" style="font-size: 1.5rem;"><img src="/static/images/total items.png" alt="" width="40" height="30"></div>
                <h4 class="mb-0 ">Total Stock</h4>
            </div>
            <h1 class="my-3">{{ total_stock }}</h1>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card text-bg-success mb-3 p-1 shadow text-center">
            <div class="d-flex align-items-center justify-content-center ">
                <div class=" me-2" style="font-size: 1.5rem;"><img src="/static/images/high stock.png" alt="" width="40" height="30"></div>
                <h4 class="mb-0">High Stock </h4>
            </div>
            <h1 class="my-3">{{ high_stock }}</h1>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card  text-bg-warning mb-3 p-1 shadow text-center">
            <div class="d-flex align-items-center justify-content-center ">
                <div class=" me-3" style="font-size: 1.5rem;"><img src="/static/images/low-stock.png" alt="" width="40" height="30"></div>
                <h4 class="mb-0">Low Stock</h4>
            </div>
            <h1 class="my-3">{{ low_stock }}</h1>
        </div>
    </div>
      <div class="col-md-3">
        <div class="card text-bg-danger mb-3 p-1 shadow text-center">
          <div class="d-flex align-items-center justify-content-center ">
            <div class=" me-3" style="font-size: 1.5rem;"><img src="/static/images/out-of-stock.png" alt="" width="40" height="30"></div>
            <h4 class=" mb-0">Out of Stock </h4>
            </div>
            <h1 class="my-3">{{ out_of_stock }}</h1>
        </div>
    </div>
    
   
    
    </div>
    </div>

 
<!-- Button to Show/Hide Items -->
 <section>
    <div class="card  p-3  bg-body roundedp-5 m-3">

<!-- <h4 class=" mb-4 fw-bold">ALL CATEGORIES</h4> -->

    <div class="row">
      <div class="col-8 align-items-start"> 
        <h4 class=" mb-4 fw-bold">All Categories</h4>

      </div>
      <div class="col-4">            <button id="toggleItemsBtn" class="btn btn-info width 50">Select Items to Generate Recipes</button>
      </div>
    </div>
<!-- Recipe Form with Checkboxes -->
<form method="POST" action="{% url 'SmartGhrWali:fetch_recipes' %}" id="recipeForm">
    {% csrf_token %}
    {% for category in categories %}
    <div class="card my-3">
        <div class="card-header d-flex align-items-center justify-content-between">
            <!-- Heading aligned to the left -->
            <h6 class="mb-0 ">{{ category.name }} ({{ category.item_set.count }} items)</h6>
        
            <!-- Button aligned to the right -->
            <button class="btn btn-dark btn-sm" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapse-{{ category.id }}" aria-expanded="false" 
                aria-controls="collapse-{{ category.id }}" style="width: auto;">
                Show Items
            </button>
        </div>
        
        <!-- Collapsible section for the items, initially hidden -->
        <div class="collapse" id="collapse-{{ category.id }}">
            <div class="card-body">
                <table class="table table-striped ">
                    <thead align="center" class="table-dark">
                        <tr>
                            <th scope="col" class="select-header" style="display: none;">Select</th> <!-- Initially hidden -->
                            <th scope="col">Item Name</th>
                            <th scope="col">Current Quantity ({{ category.unit }})</th>
                            <th scope="col">Min Quantity ({{ category.unit }})</th>
                            <th scope="col">Expiry Date</th>
                        </tr>
                    </thead>
                    <tbody align="center">
                        {% for item in category.item_set.all %}
                        <tr>
                            <td class="select-cell" style="display: none;">
                                <input type="checkbox" class="item-checkbox" name="selected_items" value="{{ item.id }}">
                            </td>
                            <td>{{ item.name }}</td>
                            <td>{{ item.curr_quantity }}</td>
                            <td>{{ item.min_quantity }}</td>
                            <td>{% if item.expiry_date %}{{ item.expiry_date|date:"F j, Y" }}{% else %}N/A{% endif %}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center">No items available in this category.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    {% endfor %}

    <!-- Submit Button -->
    <div class="text-center my-4" id="submitButtonContainer" style="display: none;">
        <button type="submit" class="btn btn-success" id="generateRecipesBtn">Generate Recipes</button>
    </div>
</form>
</div>
</section>
<!-- JavaScript to Toggle Checkbox Visibility -->
<script>
    document.getElementById('toggleItemsBtn').onclick = function () {
        const checkboxes = document.querySelectorAll('.item-checkbox');
        const selectHeader = document.querySelector('.select-header'); // Select header for toggling
        const selectCells = document.querySelectorAll('.select-cell'); // Select cell for checkboxes
        const submitButtonContainer = document.getElementById('submitButtonContainer'); // Submit button container

        // Toggle visibility of the checkboxes
        selectCells.forEach(cell => {
            cell.style.display = cell.style.display === 'none' ? '' : 'none'; // Toggle cell visibility
        });

        // Toggle visibility of the select header
        if (selectHeader) {
            selectHeader.style.display = selectHeader.style.display === 'none' ? '' : 'none';
        }

        // Show or hide the submit button
        if (submitButtonContainer) {
            submitButtonContainer.style.display = submitButtonContainer.style.display === 'none' ? '' : 'none';
        }
    };

    // Function to collapse all sections
    function collapseAll() {
        const collapsibleSections = document.querySelectorAll('.collapse'); // All collapsible sections
        collapsibleSections.forEach(section => {
            if (section.classList.contains('show')) {
                // Collapse if already shown
                bootstrap.Collapse.getInstance(section).hide();
            }
        });
    }

    // Expand all sections when generating recipes
    document.getElementById('recipeForm').onsubmit = function () {
        const collapsibleSections = document.querySelectorAll('.collapse'); // All collapsible sections
        collapsibleSections.forEach(section => {
            if (!section.classList.contains('show')) {
                // Expand if not already shown
                bootstrap.Collapse.getInstance(section).show();
            }
        });
    };
</script>

{% endblock %}